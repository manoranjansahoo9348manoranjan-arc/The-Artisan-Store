<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Artisan Store ‚Äî Full Catalog</title>
    <meta property="og:title" content="The Artisan Store" />
    <meta property="og:description" content="Handcrafted idols and luxury event decoration services." />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <style>
      :root{--brand-primary:#00b4d8;--brand-primary-dark:#0077b6;--brand-accent:#00ff7f;--brand-dark:#03045e;--brand-success:#00ff7f;--card-radius:12px;--shadow-premium:0 10px 30px rgba(0,0,0,.15);--bg-color:#f4f6f9;--text-color:#212529;--header-bg:white; --nav-bg:var(--brand-primary-dark);--card-bg:white;--glow-color:var(--brand-primary);}
      body{font-family:Inter,Arial,sans-serif;margin:0;background:var(--bg-color);font-size:16px;color:var(--text-color);transition:background-color .3s,color .3s;}
      
      /* 1. LAYOUT OPTIMIZATION: Increased Max Width for better horizontal usage */
      header{background:var(--header-bg);padding:15px 15px;color:var(--text-color);box-shadow:0 2px 4px rgba(0,0,0,.1); border-bottom: 1px solid #e0e0e0; }

      .new-header-layout {
          display: grid;
          grid-template-columns: 1fr auto 1fr; /* Search | Logo | Controls */
          align-items: center;
          max-width: 1400px; /* Increased from 1300px */
          margin: 0 auto;
          gap: 15px;
      }
      
      .brand-logo {
          justify-content: center;
          display: flex;
          align-items: center;
          gap: 10px;
      }

      .brand-logo-text {
          font-weight: 900; 
          font-size: 30px;
          color: black;
      }
      
      .brand-logo-circle {
          width: 50px;
          height: 50px;
          border-radius: 50%;
          background-color: #e9996d;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .header-search {
          justify-self: start;
          display: flex;
          align-items: center;
          width: 100%;
          max-width: 350px; /* Adjusted to fit better with new width */
          border: 1px solid #ccc;
          border-radius: 4px;
          padding: 5px 10px;
          background-color: white;
      }

      .header-search input {
          border: none !important;
          outline: none !important;
          box-shadow: none !important;
          width: 100%;
          padding: 0;
          margin-left: 8px;
          font-size: 15px;
      }

      .header-controls-right {
          justify-self: end;
          display: flex;
          align-items: center;
          gap: 10px;
      }

      /* Login button removed as requested */
      .login-btn {
          display: none !important; 
      }
      
      /* HIDE THE ENTIRE NAVIGATION BAR */
      .navbar-custom {
          display: none !important;
      }
      
      /* Carousel and Card Styling */
      #heroCarousel {height: 380px; box-shadow: var(--shadow-premium); max-width: 1400px; margin: 0 auto;}
      .carousel-item-custom {height: 380px; background-size: cover; background-position: center; position: relative;}
      .slider-caption{position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; font-size:48px; font-weight:900; text-shadow:1px 1px 8px rgba(0,0,0,1); background:rgba(0,0,0,.3); color: white; padding: 0;}
      
      /* General Content Section Styling - Increased Max Width */
      section.content-view{display:none; padding: 30px 15px; max-width: 1400px; margin: 0 auto; min-height: 80vh;}
      section.content-view.active { display: block; }

      section.container-card{padding:30px;background:var(--card-bg);margin:30px auto;border-radius:var(--card-radius);box-shadow:var(--shadow-premium);max-width:1400px; /* Increased from 1200px */ border: 1px solid #e0e0e0; transition: transform 0.4s ease-out;}
      section.container-card:hover{transform: translateY(-3px); box-shadow: 0 10px 35px rgba(0,0,0,.25);}
     .items-grid {
    display: grid;
    /* This ensures cards fill the space and remove the 'black space' on the right */
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
    gap: 25px;
}

/* Specific adjustment for smaller mobile screens */
@media (max-width: 768px) {
    .items-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 12px;
    }
}
/* Responsive Card Images */
.card img {
    width: 100%;
    height: 140px; /* Shorter for mobile */
    object-fit: cover;
}

@media (min-width: 768px) {
    .card img {
        height: 180px;
    }
}
/* Prevent content from being hidden behind the bottom nav on mobile */
@media (max-width: 767px) {
    body {
        padding-bottom: 70px;
    }
    .whatsapp-btn-fixed {
        bottom: 80px; /* Move WhatsApp button up so it doesn't block the nav */
    }
}

/* Make headers look good on all screens */
.brand-logo-text {
    font-size: clamp(18px, 4vw, 30px);
}

.slider-caption {
    font-size: clamp(1.2rem, 5vw, 3rem);
    padding: 20px;
    text-align: center;
}
      
      /* New Card Styling for more content */
      .card{background:var(--card-bg);border-radius:var(--card-radius);padding:10px;text-align:left;box-shadow:0 4px 10px rgba(0,0,0,.08);transition:transform .2s,box-shadow .2s,background-color .3s; border: 1px solid #f0f0f0; position: relative;}
      .card:hover{transform:translateY(-3px) scale(1.01);}
      .card img{width:100%;height:180px;object-fit:cover;border-radius:8px;}
      .card-body { padding: 10px 5px 0 5px; }
      .price{font-size:20px;font-weight:700;color:var(--brand-primary);margin-top:4px;}
      .card-title { font-size: 18px; font-weight: 600; margin-bottom: 5px; }
      
      .card-info { font-size: 13px; color: #6c757d; margin-bottom: 5px; }
      .rating-stars { color: #ffc107; font-size: 14px; }
      .stock-status { font-weight: 500; }
      
      .action-buttons { display: flex; gap: 5px; margin-top: 10px; }
      .wishlist-share { position: absolute; top: 15px; right: 15px; display: flex; gap: 5px; }

      /* Added new CSS for the blinking effect on Add to Cart */
      @keyframes cart-flash {
          0%, 100% { box-shadow: 0 4px 10px rgba(0,0,0,.08); }
          50% { box-shadow: 0 0 20px 5px var(--brand-success), 0 0 10px 1px var(--brand-success); }
      }

      .card.cart-flash-active {
          animation: cart-flash 1.5s ease-out;
      }
      
      /* Fixed WhatsApp button (Replaces fixed Share) */
      .whatsapp-btn-fixed{position:fixed;bottom:20px;right:20px;background:#25D366;color:white;padding:15px;border-radius:50%;font-size:28px;z-index:9999;animation:pulse 2s infinite; box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);}
      .whatsapp-btn-fixed:hover { background: #128C7E; }
      
      /* Wishlist button in the header */
      .wishlist-header-btn {
          position: relative;
      }
      .wishlist-count-badge, .cart-count-badge {
          position: absolute;
          top: -5px;
          right: -5px;
          font-size: 10px;
          padding: 3px 6px;
          background-color: #e9996d;
          color: white;
          border-radius: 50%;
          border: 1px solid white;
          line-height: 1;
      }
      
      .muted{color:#6b7280;}
      footer{text-align:center;padding:15px;font-size:14px;color:#6b7280;}
      .custom-translate-container{display:flex;align-items:center;margin-left:15px;gap:6px;color:black;}
      .custom-translate-container #language-select-custom {display: inline-block !important; width: 130px; height: 35px; padding: 4px 10px; font-size: 14px;}
      #google_translate_element_hidden{display:none;}
      
      /* Dark Mode fixes for new header */
      body.dark-mode{--header-bg:#161b22; --text-color:#f8f9fa;}
      body.dark-mode header{border-bottom-color: #30363d;}
      body.dark-mode .brand-logo-text, body.dark-mode .header-search, body.dark-mode .header-search input, body.dark-mode .currency-selector{color: var(--text-color) !important; background-color: #30363d !important; border-color: #484f58 !important;}
      body.dark-mode .login-btn{color: #e9996d !important;}
      
      /* Mobile Layout */
      @media (max-width: 991.98px) {
          .new-header-layout {
              grid-template-columns: 1fr 1fr;
              row-gap: 10px;
          }
          .header-search {
              grid-column: 1 / 3;
              max-width: 100%;
              order: 3;
          }
          .brand-logo {
              justify-content: flex-start;
              order: 1;
          }
          .header-controls-right {
              order: 2;
              gap: 5px;
          }
          .currency-selector {
              display: none;
          }
          .whatsapp-btn-fixed {
              bottom: 60px; 
          }
      }
    </style>
</head>
<body>
    
    <header>
        <div class="new-header-layout">
            
            <div class="header-search">
                <i class="bi bi-search" style="color: #6c757d;"></i>
                <input id="desktopSearchInput" type="search" placeholder="Search products..." aria-label="Search" onkeyup="filterProducts(this.value)">
            </div>
            
            <div class="brand-logo">
                <a href="#home" class="brand-logo" style="text-decoration: none;">
                    <div class="brand-logo-circle">
                        <i class="bi bi-tools" style="font-size: 28px; color: white;"></i>
                    </div>
                    <div class="brand-logo-text">The Artisan Store</div>
                </a>
            </div>
            
            <div class="header-controls-right">
                <a href="#orders" class="btn btn-outline-secondary p-2 wishlist-header-btn" style="border: 1px solid #ccc;">
        <i class="bi bi-bag-check"></i><span class="ms-1 d-none d-lg-inline">Orders</span>
    </a>
              
              
                <a href="#wishlist" class="btn btn-outline-secondary p-2 wishlist-header-btn" style="border: 1px solid #ccc;">
                    <i class="bi bi-heart-fill"></i><span class="ms-1 d-none d-lg-inline">Wishlist </span>
                    <span class="wishlist-count-badge" id="wishlistCount">0</span>
                </a>
                
                <a href="#cart" class="btn btn-outline-secondary p-2 wishlist-header-btn" style="border: 1px solid #ccc;">
                    <i class="bi bi-cart3"></i><span class="ms-1 d-none d-lg-inline">Cart </span>
                    <span class="cart-count-badge" id="cartCount">0</span>
                </a>
                
            </div>
        </div>
    </header>

    <div id="google_translate_element_hidden" style="display: none"></div>
    
    <section id="main-catalog-view" class="content-view active">
        
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner" id="carouselInner">
                </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
        
        <section id="decor" class="container-card">
            <h2 class="text-center mb-4 text-primary">‚ú® Event Decoration Services</h2>
            <div class="d-flex justify-content-between align-items-center my-3 flex-wrap gap-2">
                <div>
                    <span class="text-muted d-block d-md-inline">(Click on a card for full details)</span>
                </div>
                <div class="d-flex gap-2">
                    <select id="decorCategoryFilter" class="form-select w-auto" onchange="renderCatalog()">
                        <option value="All">All Decor Packages</option>
                        <option value="Marriage">Marriage Decor</option>
                        <option value="Birthday">Birthday Decor</option>
                        <option value="Corporate">Corporate Events</option>
                        <option value="Baby Shower">Baby Shower</option>
                    </select>
                    <button class="btn btn-outline-secondary" onclick="clearFilters()">Clear Filters</button>
                </div>
            </div>
            <div class="items-grid" id="decorGrid">
                <p class="text-muted">Loading decoration packages...</p>
            </div>
            <div class="text-center mt-4">
                <a href="#all-decor" class="btn btn-outline-primary btn-lg" >
                    <i class="bi bi-grid-fill"></i> View All Decor Packages
                </a>
            </div>
        </section>

        <section id="idols" class="container-card">
            <h2 class="text-center mb-4 text-primary">üïâÔ∏è Artisan Idols & Murtis</h2>
            <div class="d-flex justify-content-end align-items-center my-3 gap-2">
                <select id="idolCategoryFilter" class="form-select w-auto" onchange="renderCatalog()">
                    <option value="All">All Idols</option>
                    <option value="Ganesh">Ganesh</option>
                    <option value="Saraswati">Saraswati</option>
                    <option value="Shiva">Shiva</option>
                    <option value="Lakshmi">Lakshmi</option>
                    <option value="Custom">Custom/Services</option>
                </select>
                <button class="btn btn-outline-secondary" onclick="clearFilters()">Clear Filters</button>
            </div>
            <div class="items-grid" id="idolsGrid">
                <p class="text-muted">Loading handcrafted idols...</p>
            </div>
             <div class="text-center mt-4">
                 <a href="#all-idols" class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-gem"></i> View All Idols & Accessories
                </a>
            </div>
        </section>

        <section id="services-contact" class="container-card">
            <h2 class="text-center mb-4 text-primary">üé® Design Services & Consultations</h2>
            <p class="lead">We offer bespoke design services for custom idols, unique event themes, and full production planning. Contact us for a detailed consultation.</p>
            <div class="text-center">
                <a class="btn btn-primary btn-lg mt-3" href="https://wa.me/919999999999?text=Hello%2C%20I%20would%20like%20to%20enquire%20about%20your%20design%20services." target="_blank">
                    <i class="bi bi-chat-dots-fill"></i> Discuss My Project
                </a>
            </div>
            <hr class="my-4">
            <h2 class="text-center mb-4 text-primary">üìû Contact & Location</h2>
            <p class="lead"><strong>Phone:</strong><a href="tel:+919999999999" class="text-decoration-none text-success">+91-9999999999</a></p>
            <p class="lead"><strong>Address:</strong> Your Shop Address Here (Open 10 AM - 8 PM)</p>
        </section>
        
    </section>

    <section id="all-decor-view" class="content-view">
        <div class="d-flex justify-content-between align-items-center pt-3 pb-4">
            <h1><i class="bi bi-grid-fill text-primary"></i> All Event Decoration Packages</h1>
            <a href="#home" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Back to Home</a>
        </div>
        <div class="items-grid" id="allDecorGrid">
            <p class="col-12 text-muted">Loading all 50+ decoration packages...</p>
        </div>
    </section>

    <section id="all-idols-view" class="content-view">
        <div class="d-flex justify-content-between align-items-center pt-3 pb-4">
            <h1><i class="bi bi-gem text-primary"></i> All Artisan Idols & Accessories</h1>
            <a href="#home" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Back to Home</a>
        </div>
        <div class="items-grid" id="allIdolsGrid">
            <p class="col-12 text-muted">Loading all 50+ idols and accessories...</p>
        </div>
    </section>

    <section id="wishlist-page-view" class="content-view">
        <div class="d-flex justify-content-between align-items-center pt-3 pb-4">
            <h1><i class="bi bi-heart-fill text-danger"></i> Your Wishlist</h1>
            <a href="#home" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Continue Shopping</a>
        </div>
        <div class="items-grid" id="wishlistGrid">
            </div>
    </section>

    <section id="cart-page-view" class="content-view">
        <div class="d-flex justify-content-between align-items-center pt-3 pb-4">
            <h1><i class="bi bi-cart3 text-primary"></i> Your Shopping Cart</h1>
            <a href="#home" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Continue Shopping</a>
        </div>
        <div id="cartContent" class="row">
            </div>
    </section>

<section id="checkout-page-view" class="content-view">
    <div class="container-card">
        <h2 class="mb-4 text-primary"><i class="bi bi-truck"></i> Shipping & Delivery</h2>
        <form id="checkoutForm" class="row g-3">
            <div class="col-md-6">
                <label class="form-label fw-bold">Full Name</label>
                <input type="text" id="custName" class="form-control" required placeholder="Enter your name">
            </div>
            <div class="col-md-6">
                <label class="form-label fw-bold">Indian Phone No.</label>
                <input type="tel" id="custPhone" class="form-control" maxlength="10" oninput="this.value=this.value.replace(/[^0-9]/g,'');" required placeholder="10-digit mobile number">
            </div>
            <div class="col-12">
                <label class="form-label fw-bold">Full Address</label>
                <textarea id="custAddress" class="form-control" rows="3" required placeholder="House No, Street, Landmark..."></textarea>
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-outline-primary" onclick="detectLocation()">
                    <i class="bi bi-geo-alt-fill"></i> Use Current Location
                </button>
                <p id="locationStatus" class="small text-muted mt-1"></p>
            </div>
            <div class="col-12 bg-light p-3 rounded border">
                <h5>Order Summary</h5>
                <div id="checkoutSummary"></div>
                <hr>
                <div class="d-flex justify-content-between fw-bold fs-5">
                    <span>Total Payable (Incl. Delivery):</span>
                    <span id="finalPayableAmount" class="text-success">‚Çπ0</span>
                </div>
            </div>
            <div class="col-12 text-end">
                <button type="submit" class="btn btn-success btn-lg">Proceed to Payment</button>
            </div>
        </form>
    </div>
</section>

<section id="payment-page-view" class="content-view">
    <div class="container-card text-center">
        <h2 class="mb-4 text-primary">Secure Payment</h2>
        <div class="row">
            <div class="col-md-6 mx-auto text-start">
                <div class="list-group mb-4 shadow-sm">
                    <button class="list-group-item list-group-item-action d-flex align-items-center gap-3 py-3" onclick="processPayment('Cash on Delivery')">
                        <i class="bi bi-cash-stack fs-3 text-success"></i> Cash on Delivery (COD)
                    </button>
                    
                    <button class="list-group-item list-group-item-action d-flex align-items-center gap-3 py-3" data-bs-toggle="collapse" data-bs-target="#upiOptions">
                        <i class="bi bi-upc-scan fs-3 text-primary"></i> UPI (PhonePe / GPay / BHIM)
                    </button>
                    
                    <div class="collapse p-3 border-start border-end bg-light" id="upiOptions">
                        <button class="btn btn-outline-dark btn-sm w-100 mb-2" onclick="processPayment('UPI App')">
                            <i class="bi bi-phone"></i> Open UPI App
                        </button>
                        <div class="input-group input-group-sm">
                            <input type="text" id="upiIdInput" class="form-control" placeholder="Enter UPI ID (e.g. name@upi)">
                            <button class="btn btn-primary" onclick="processPayment('UPI ID')">Pay Now</button>
                        </div>
                    </div>

                    <button class="list-group-item list-group-item-action d-flex align-items-center gap-3 py-3" onclick="processPayment('Net Banking')">
                        <i class="bi bi-bank fs-3 text-secondary"></i> Net Banking
                    </button>
                    
                    <button class="list-group-item list-group-item-action d-flex align-items-center gap-3 py-3" onclick="processPayment('Card')">
                        <i class="bi bi-credit-card fs-3 text-dark"></i> Debit / Credit Card
                    </button>
                </div>
                
                <div class="p-3 border rounded bg-white text-center">
                    <p class="mb-1 text-muted small">Merchant UPI ID</p>
                    <h6 class="text-dark fw-bold">artisanstore@okaxis</h6>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="orders-page-view" class="content-view">
    <div class="container-card">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-primary"><i class="bi bi-bag-check-fill"></i> My Orders</h2>
            <button class="btn btn-outline-danger btn-sm" onclick="clearAllOrders()">Clear All History</button>
        </div>
        <div id="ordersContainer"></div>
    </div>
</section>


    
    
    <footer>
        <p onclick="openAdmin()" style="cursor: pointer;" title="Click for Admin Panel">¬© 2025 The Artisan Store. All Rights Reserved. Prototype v3.0</p>
    </footer>

    <a class="whatsapp-btn-fixed" href="https://wa.me/919999999999?text=Hello%2C%20I%20have%20an%20enquiry%20about%20your%20products." target="_blank" title="Chat on WhatsApp">
        <i class="bi bi-whatsapp"></i>
    </a>
    <div class="modal fade" id="productDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="productDetailTitle">Product Detail</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
                <div class="modal-body row">
                    <div class="col-md-5"><img id="productDetailImage" src="" class="img-fluid rounded-3 mb-3" alt="Product Image"/></div>
                    <div class="col-md-7">
                        <p class="lead" id="productDetailCategory"></p><h3 class="text-success" id="productDetailPrice"></h3><hr/>
                        <p id="productDetailDescription"></p>
                        <div class="d-flex gap-2">
                            <button id="modalBuyButton" class="btn btn-success btn-lg mt-3"><i class="bi bi-bag-fill"></i> Buy Now</button>
                            <button id="modalEnquiryButton" class="btn btn-primary btn-lg mt-3"><i class="bi bi-telephone-fill"></i> Enquire</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    <div class="modal fade" id="qrCodeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Scan to Pay (UPI)</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
                <div class="modal-body text-center">
                    <p>Scan this QR code with any UPI App (e.g., Google Pay, PhonePe, Paytm) to pay the advance amount.</p>
                    <img src="https://via.placeholder.com/180/1aae3b/FFFFFF?text=UPI+QR+Code" alt="UPI QR Code Placeholder" class="img-fluid p-3 border rounded" style="width: 180px; height: 180px"/>
                    <p class="mt-3"><strong>Amount: ‚Çπ500 Advance</strong></p>
                    <small class="text-muted">In a production environment, this QR code would be dynamically generated for your shop's UPI ID.</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="adminModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white"><h5 class="modal-title">üîê Admin Panel ‚Äî Products & Bookings</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="adminTabs" role="tablist">
                        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabProducts">Products</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabBookings">Bookings</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabSettings">Settings</button></li>
                    </ul>
                    <div class="tab-content pt-3">
                        <div class="tab-pane fade show active" id="tabProducts">
                            <div class="d-flex justify-content-between align-items-center mb-3"><h6>Manage Products</h6><button class="btn btn-primary" onclick="showProductForm()">+ Add Product</button></div>
                            <div id="adminProductsList" class="row g-3"></div>
                            <div id="productForm" style="display: none" class="mt-3">
                                <h6 id="productFormTitle">Add Product</h6>
                                <div class="row g-2">
                                    <div class="col-md-4"><input id="p_title" class="form-control" placeholder="Title"/></div>
                                    <div class="col-md-2"><input id="p_price" class="form-control" placeholder="Price (‚Çπ)" type="number"/></div>
                                    <div class="col-md-3"><input id="p_image" class="form-control" placeholder="Image URL (e.g., ganesh.jpg)"/></div>
                                    <div class="col-md-3"><select id="p_category" class="form-select"><option>Decor</option><option>Idol</option><option>Other</option></select></div>
                                    <div class="col-12"><textarea id="p_desc" class="form-control" rows="2" placeholder="Description"></textarea></div>
                                    <div class="col-12 d-flex gap-2"><button class="btn btn-success" onclick="saveProduct()">Save</button><button class="btn btn-secondary" onclick="hideProductForm()">Cancel</button></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="tabBookings"><h6>Recent Bookings</h6><div id="adminBookingsList"></div></div>
                        <div class="tab-pane fade" id="tabSettings"><h6>Settings & Integrations</h6><p><strong>Payment Integration:</strong> Stripe & Razorpay placeholders. This requires server-side setup for production.</p><p><strong>WordPress Export:</strong> Use the theme skeleton to convert the site.</p><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="useMockPayment" checked/><label class="form-check-label" for="useMockPayment">Use mock payment (test) mode</label></div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
/* ---------------------------------------------------------
    DATABASE + DEFAULT DATA (30 products)
--------------------------------------------------------- */
const DB_KEYS = {
    PRODUCTS: "art_products_v3",
    BOOKINGS: "art_bookings_v3",
    CART: "art_cart_v3",
    WISHLIST: "art_wishlist_v3"
};

const DEFAULT_PRODUCTS = [
    { id: "d1", title: "Royal Ballroom Marriage Decor", price: 35000, img: "https://picsum.photos/1200/400?random=11", category: "Marriage", desc: "Luxurious, fully-customizable ballroom decor package with premium silks and lighting.", rating: 4.8, purchases: 15, stock: 99, tags: ["Event", "Premium"] },
    { id: "d2", title: "Outdoor Wedding Mandap Setup", price: 22000, img: "https://picsum.photos/1200/400?random=12", category: "Marriage", desc: "Elegant garden-themed mandap setup with fresh flowers and sheer fabrics.", rating: 4.5, purchases: 28, stock: 99, tags: ["Event", "Outdoor"] },
    { id: "d3", title: "First Birthday Jungle Theme", price: 4500, img: "https://picsum.photos/1200/400?random=13", category: "Birthday", desc: "Fun, vibrant jungle animal theme with a large backdrop and custom balloon arch.", rating: 4.9, purchases: 45, stock: 99, tags: ["Event", "Kids"] },
    { id: "d4", title: "Teen's Neon Glow Party Decor", price: 6000, img: "https://picsum.photos/1200/400?random=14", category: "Birthday", desc: "Blacklight-reactive decorations and sound system for a memorable teen party.", rating: 4.7, purchases: 12, stock: 99, tags: ["Event", "Modern"] },
    { id: "i1", title: "Ganesh Idol ‚Äî Eco-friendly Clay", price: 1899, img: "https://picsum.photos/1200/400?random=15", category: "Ganesh", desc: "Medium-sized, beautifully sculpted Ganesh murti, made with natural, dissolvable clay.", rating: 4.9, purchases: 112, stock: 50, tags: ["Idol", "Clay"] },
    { id: "i2", title: "Large Brass Ganesh Murti", price: 9500, img: "https://picsum.photos/1200/400?random=16", category: "Ganesh", desc: "Heavy brass idol, perfect for home temples, with intricate traditional carvings.", rating: 4.6, purchases: 25, stock: 15, tags: ["Idol", "Brass"] },
    { id: "i3", title: "Saraswati Idol ‚Äî Pure White Marble", price: 2499, img: "https://picsum.photos/1200/400?random=17", category: "Saraswati", desc: "A serene, white marble-finish Saraswati idol, ideal for students and artists.", rating: 4.8, purchases: 88, stock: 35, tags: ["Idol", "Marble"] },
    { id: "i4", title: "Custom Idol ‚Äî Design Consultation", price: 500, img: "https://picsum.photos/1200/400?random=18", category: "Custom", desc: "A booking fee for a 1-hour consultation with our master sculptor for a unique, custom-made idol.", rating: 5.0, purchases: 5, stock: 999, tags: ["Service", "Custom"] },
    { id: "d5", title: "Corporate Event Setup - Modern", price: 15000, img: "https://picsum.photos/1200/400?random=19", category: "Corporate", desc: "Sleek, professional decor package including stage design, minimalist lighting, and branded backdrops.", rating: 4.6, purchases: 8, stock: 99, tags: ["Event", "Corporate"] },
    { id: "d6", title: "Baby Shower Pastel Theme", price: 3200, img: "https://picsum.photos/1200/400?random=20", category: "Baby Shower", desc: "Charming pastel-themed decor with balloon clouds, floral arrangements, and 'Mom-to-Be' chair setup.", rating: 4.7, purchases: 35, stock: 99, tags: ["Event", "Kids"] },
    { id: "i5", title: "Durga Maa Idol ‚Äî Fiber Reinforced Plastic (FRP)", price: 7999, img: "https://picsum.photos/1200/400?random=21", category: "Durga", desc: "Vibrant, lightweight FRP idol of Maa Durga, highly detailed and suitable for long-term display or large pandals.", rating: 4.7, purchases: 18, stock: 10, tags: ["Idol", "FRP"] },
    { id: "i6", title: "Small Shiva Lingam ‚Äî Black Granite", price: 2999, img: "https://picsum.photos/1200/400?random=22", category: "Shiva", desc: "Authentic, hand-polished black granite Shiva Lingam, ideal for personal daily worship (Pooja).", rating: 4.9, purchases: 62, stock: 20, tags: ["Idol", "Stone"] },
    { id: "d7", title: "Vintage Theme Engagement Party Decor", price: 18000, img: "https://picsum.photos/1200/400?random=23", category: "Marriage", desc: "Rustic chic decor with antique lace, distressed wood signs, and warm Edison bulb lighting.", rating: 4.6, purchases: 18, stock: 99, tags: ["Event", "Vintage"] },
    { id: "d8", title: "Half-Saree/Pattu Langa Ceremony Decor", price: 11000, img: "https://picsum.photos/1200/400?random=24", category: "Cultural", desc: "Traditional South Indian decor with marigold flowers, banana leaves, and vibrant silk draping.", rating: 4.9, purchases: 32, stock: 99, tags: ["Event", "Cultural"] },
    { id: "d9", title: "Superhero Kids Birthday Party", price: 5500, img: "https://picsum.photos/1200/400?random=25", category: "Birthday", desc: "Action-packed theme with city backdrop, character cutouts, and custom cape station.", rating: 4.7, purchases: 55, stock: 99, tags: ["Event", "Kids"] },
    { id: "d10", title: "Elegant Retirement Dinner Setup", price: 9000, img: "https://picsum.photos/1200/400?random=26", category: "Corporate", desc: "Subdued, classy dining decor with centerpiece florals, ambient uplighting, and a photo memorial display.", rating: 4.5, purchases: 10, stock: 99, tags: ["Event", "Corporate"] },
    { id: "d11", title: "Festival Pop-Up Stall Setup", price: 3000, img: "https://picsum.photos/1200/400?random=27", category: "Festival", desc: "Quick and easy-to-assemble canopy, banner stand, and foldable table for market festivals.", rating: 4.4, purchases: 75, stock: 99, tags: ["Event", "Festival"] },
    { id: "d12", title: "LED Furniture Rental Package", price: 12000, img: "https://picsum.photos/1200/400?random=28", category: "Lighting & Furnishings", desc: "Includes 4 LED cubes, 2 LED cocktail tables, and 1 LED bar counter with remote color control.", rating: 4.8, purchases: 15, stock: 99, tags: ["Event", "Modern"] },
    { id: "d13", title: "Photo Booth Backdrop & Props Kit", price: 2500, img: "https://picsum.photos/1200/400?random=29", category: "Accessories", desc: "Glittering sequin backdrop (8x8 ft) with a box of 50 themed novelty props.", rating: 4.9, purchases: 95, stock: 99, tags: ["Event", "Accessories"] },
    { id: "i7", title: "Radha-Krishna Idol ‚Äî Polyresin", price: 4999, img: "https://picsum.photos/1200/400?random=30", category: "Krishna", desc: "Hand-painted, colorful polyresin idol of Radha and Krishna, ideal for living room or temple niche.", rating: 4.7, purchases: 40, stock: 25, tags: ["Idol", "Polyresin"] },
    { id: "i8", title: "Hanuman Murti ‚Äî Red Terracotta", price: 1599, img: "https://picsum.photos/1200/400?random=31", category: "Hanuman", desc: "Vigorous pose Hanuman idol, crafted from traditional fired terracotta, medium size.", rating: 4.6, purchases: 70, stock: 30, tags: ["Idol", "Terracotta"] },
    { id: "i9", title: "Lakshmi Idol ‚Äî Marble Finish", price: 3800, img: "https://picsum.photos/1200/400?random=32", category: "Lakshmi", desc: "Goddess Lakshmi sitting on a lotus, featuring a smooth, marble-like finish on a durable resin base.", rating: 4.8, purchases: 65, stock: 22, tags: ["Idol", "Resin"] },
    { id: "i10", title: "Buddha Statue ‚Äî Meditating Stone", price: 6500, img: "https://picsum.photos/1200/400?random=33", category: "Buddhist", desc: "Large, serene meditating Buddha statue, made from weather-resistant composite stone for gardens or indoor use.", rating: 4.9, purchases: 20, stock: 12, tags: ["Idol", "Stone"] },
    { id: "i11", title: "Miniature Set of Nava Graha Idols", price: 1200, img: "https://picsum.photos/1200/400?random=34", category: "Zodiac/Planets", desc: "A set of nine small idols representing the nine celestial bodies, essential for certain Pujas.", rating: 4.5, purchases: 48, stock: 40, tags: ["Idol", "Pooja"] },
    { id: "i12", title: "Aarti Diya (Lamp) ‚Äî Five-Wick Brass", price: 850, img: "https://picsum.photos/1200/400?random=35", category: "Religious Accessories", desc: "Traditional five-wick oil lamp (Panchmukhi Diya), crafted from high-quality polished brass.", rating: 4.9, purchases: 150, stock: 50, tags: ["Accessory", "Brass"] },
    { id: "i13", title: "Rudraksha Mala ‚Äî 108+1 Beads", price: 450, img: "https://picsum.photos/1200/400?random=36", category: "Religious Accessories", desc: "Authentic, medium-sized Rudraksha beads strung for chanting and wearing.", rating: 4.7, purchases: 180, stock: 100, tags: ["Accessory", "Pooja"] },
    { id: "i14", title: "Kalash/Pooja Pot ‚Äî Copper", price: 1100, img: "https://picsum.photos/1200/400?random=37", category: "Religious Accessories", desc: "Essential Pooja vessel, made of pure polished copper with a wide base and narrow neck.", rating: 4.8, purchases: 90, stock: 30, tags: ["Accessory", "Copper"] },
    { id: "i15", title: "Vastu Shastra Consultation Service", price: 7500, img: "https://picsum.photos/1200/400?random=38", category: "Service", desc: "In-depth, full-day consultation for residential or commercial property layout based on Vastu principles.", rating: 5.0, purchases: 3, stock: 99, tags: ["Service", "Vastu"] },
    { id: "i16", title: "Gemstone Yantra - Sri Yantra", price: 3200, img: "https://picsum.photos/1200/400?random=39", category: "Yantra", desc: "Engraved Sri Yantra on a base of rose quartz for prosperity and positive energy.", rating: 4.6, purchases: 25, stock: 18, tags: ["Idol", "Gemstone"] },
    { id: "i17", title: "Customized Event Backdrop Printing", price: 4000, img: "https://picsum.photos/1200/400?random=40", category: "Service", desc: "High-resolution, custom-sized flex or cloth banner printing service (per 100 sq ft).", rating: 4.7, purchases: 30, stock: 99, tags: ["Service", "Event"] }
];

/* ---------------------------------------------------------
    LOAD / SAVE FUNCTIONS (Unchanged)
--------------------------------------------------------- */
function loadProducts() {
    return JSON.parse(localStorage.getItem(DB_KEYS.PRODUCTS)) || DEFAULT_PRODUCTS;
}
function saveProducts(p) {
    localStorage.setItem(DB_KEYS.PRODUCTS, JSON.stringify(p));
}
function loadBookings() {
    return JSON.parse(localStorage.getItem(DB_KEYS.BOOKINGS)) || [];
}
function saveBookings(b) {
    localStorage.setItem(DB_KEYS.BOOKINGS, JSON.stringify(b));
}
function loadCart() {
    return JSON.parse(localStorage.getItem(DB_KEYS.CART)) || [];
}
function saveCart(cart) {
    localStorage.setItem(DB_KEYS.CART, JSON.stringify(cart));
    updateCartCount();
    if (window.location.hash === '#cart') { renderCartPage(); }
}
function loadWishlist() {
    return JSON.parse(localStorage.getItem(DB_KEYS.WISHLIST)) || [];
}
function saveWishlist(wishlist) {
    localStorage.setItem(DB_KEYS.WISHLIST, JSON.stringify(wishlist));
    updateWishlistCount();
    if (window.location.hash === '#home' || window.location.hash === '') {
        renderCatalog(document.getElementById("desktopSearchInput").value);
    }
}

function clearFilters() {
    document.getElementById("decorCategoryFilter").value = "All";
    document.getElementById("idolCategoryFilter").value = "All";
    
    const desktopSearch = document.getElementById("desktopSearchInput");
    if (desktopSearch) desktopSearch.value = "";
    
    renderCatalog(""); 
}

/* ---------------------------------------------------------
    NEW: UNIVERSAL PRODUCT FINDER (Necessary for wishlist color sync on all pages)
--------------------------------------------------------- */
// Helper function to dynamically generate extra products.
function generateExtraProducts(prefix, count, isDecor) {
    const categories = isDecor 
        ? ["Marriage", "Birthday", "Corporate", "Baby Shower"] 
        : ["Ganesh", "Saraswati", "Shiva", "Lakshmi"];
        
    const products = [];
    for(let i = 1; i <= count; i++) {
        const id = `${prefix}-${i}`;
        const category = categories[i % categories.length];
        const title = isDecor ? `${category} Package ${i+1}` : `${category} Idol ${i+1} (Art) `;
        products.push({
            id: id,
            title: title,
            price: (isDecor ? 10000 : 3000) + (i * 100),
            img: `https://picsum.photos/1200/400?random=${prefix}${i}`,
            category: category,
            desc: `Full ${title} description. A unique custom-made package/idol.`,
            rating: 3.5 + (i % 16) / 10,
            purchases: 10 + (i * 2),
            stock: 5 + (i % 10),
            tags: [isDecor ? "Event" : "Idol", category]
        });
    }
    return products;
}

// Function to get ALL products (default + generated)
function getAllProducts() {
    const defaultProducts = loadProducts();
    // Generate up to 50 extra decor and 50 extra idol products for demonstration
    const extraDecor = generateExtraProducts("d_extra", 50, true);
    const extraIdols = generateExtraProducts("i_extra", 50, false);
    
    return [...defaultProducts, ...extraDecor, ...extraIdols];
}

function findProductById(id) {
    return getAllProducts().find(p => p.id === id);
}


/* ---------------------------------------------------------
    UTILITY FUNCTIONS (Unchanged)
--------------------------------------------------------- */
function getRatingStars(rating) {
    const fullStar = '<i class="bi bi-star-fill"></i>';
    const halfStar = '<i class="bi bi-star-half"></i>';
    const emptyStar = '<i class="bi bi-star"></i>';
    let stars = '';
    
    for (let i = 1; i <= 5; i++) {
        if (rating >= i) {
            stars += fullStar;
        } else if (rating > i - 1 && rating < i) {
            stars += halfStar;
        } else {
            stars += emptyStar;
        }
    }
    return `<span class="rating-stars">${stars}</span>`;
}

function updateCartCount() {
    const cart = loadCart();
    // Use querySelectorAll to find BOTH desktop and mobile badges
    const badges = document.querySelectorAll('.cart-count-badge');
    badges.forEach(badge => {
        badge.innerText = cart.length;
    });
}

function updateWishlistCount() {
    const wishlist = loadWishlist();
    // Use querySelectorAll to find BOTH desktop and mobile badges
    const badges = document.querySelectorAll('.wishlist-count-badge');
    badges.forEach(badge => {
        badge.innerText = wishlist.length;
    });
}


/* ---------------------------------------------------------
    FEATURE FUNCTIONS (Logic confirmed correct for wishlist color sync)
--------------------------------------------------------- */

/**
 * Adds a product to the cart and triggers a visual flash/blink on the product card.
 * @param {Event} event 
 * @param {string} id 
 */
function addToCart(event, id) {
    event.stopPropagation(); 
    
    // Uses the universal finder
    const product = findProductById(id);
    if (!product) return;
    
    let cart = loadCart();
    let cartItem = cart.find(item => item.id === id);
    
    if (cartItem) {
        cartItem.quantity += 1;
    } else {
        cart.push({ id: id, title: product.title, price: product.price, img: product.img, quantity: 1 });
    }
    
    saveCart(cart);

    // Blinking Effect for visual feedback
    const card = event.currentTarget.closest('.card');
    if (card) {
        card.classList.add('cart-flash-active');
        // Remove the class after 1.5 seconds (matches CSS animation duration)
        setTimeout(() => {
            card.classList.remove('cart-flash-active');
        }, 1500); 
    }
}

function addToWishlist(event, id) {
    event.stopPropagation();
    
    let wishlist = loadWishlist();
    const productIndex = wishlist.findIndex(item => item.id === id);

    if (productIndex > -1) {
        wishlist.splice(productIndex, 1);
        // No alert as requested
    } else {
        // Uses the universal finder
        const product = findProductById(id);
        if (product) {
            wishlist.push({ 
                id: id, 
                title: product.title, 
                price: product.price, 
                img: product.img, 
                category: product.category, 
                rating: product.rating,
                purchases: product.purchases,
                stock: product.stock
            });
            // No alert as requested
        }
    }
    
    saveWishlist(wishlist);
    // If on the wishlist page, re-render it to reflect removal/addition instantly
    if (window.location.hash === '#wishlist') { 
        renderWishlistPage(); 
    } else if (window.location.hash === '#all-decor') {
        renderAllDecorPage(); // Re-render to update heart colors
    } else if (window.location.hash === '#all-idols') {
        renderAllIdolsPage(); // Re-render to update heart colors
    }
}

function removeFromCart(id) {
    let cart = loadCart().filter(item => item.id !== id);
    saveCart(cart);
    renderCartPage(); 
}

function updateCartQuantity(id, change) {
    let cart = loadCart();
    let item = cart.find(item => item.id === id);

    if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
            return removeFromCart(id);
        }
        saveCart(cart);
        renderCartPage();
    }
}


// Share Function (Placeholder logic)
function shareProduct(event, id) {
    event.stopPropagation();
    // Uses the universal finder
    const product = findProductById(id);
    if (navigator.share) {
        navigator.share({
            title: product.title,
            text: product.desc.substring(0, 100) + '...',
            url: window.location.origin + window.location.pathname + '#product-' + id, // Mock URL
        })
        .then(() => console.log('Successful share'))
        .catch((error) => console.log('Error sharing', error));
    } else {
        alert(`Share link for ${product.title}: ${window.location.origin + window.location.pathname + '#product-' + id}`);
    }
}


/* ---------------------------------------------------------
    PAGE RENDERING FUNCTIONS
--------------------------------------------------------- */

// Helper function to generate a product card template (reused in all renderers)
function createProductCard(p) {
    const wishlist = loadWishlist(); 
    const isInWishlist = wishlist.some(item => item.id === p.id);
    // THIS LINE IS THE CORE LOGIC FOR COLOR CHANGE
    const heartClass = isInWishlist ? 'text-danger' : 'text-secondary'; 
    
    // Check if on the wishlist page to change the tooltip text
    const wishlistActionText = window.location.hash === '#wishlist' ? 'Remove from Wishlist' : (isInWishlist ? 'Remove from Wishlist' : 'Add to Wishlist');
    
    let cardImgUrl = p.img.replace(/1200\/400/, '400/300');
    
    const stockStatus = p.stock > 10 ? 
        `<span class="text-success stock-status">In Stock (${p.stock})</span>` : 
        `<span class="text-warning stock-status">Low Stock (${p.stock})</span>`;

    return `
    <div class="card" onclick="openProductDetail('${p.id}')" data-product-id="${p.id}" style="cursor: pointer;">
        <img src="${cardImgUrl}" alt="${p.title}" class="card-img-top" />
        
        <div class="wishlist-share">
            <button class="btn btn-sm btn-light p-1" onclick="addToWishlist(event, '${p.id}')" title="${wishlistActionText}">
                <i class="bi bi-heart-fill ${heartClass}"></i>
            </button>
            <button class="btn btn-sm btn-light p-1" onclick="shareProduct(event, '${p.id}')" title="Share Product">
                <i class="bi bi-share-fill"></i>
            </button>
        </div>

        <div class="card-body">
            <h5 class="card-title">${p.title}</h5>
            <p class="card-info mb-1">
                ${getRatingStars(p.rating)} (${p.rating}) | ${p.purchases} Purchases
            </p>
            <p class="card-info">
                <strong>Category:</strong> ${p.category} | ${stockStatus}
            </p>
            <p class="price">‚Çπ${p.price.toLocaleString('en-IN')}</p>
            
            <div class="action-buttons">
                <button class="btn btn-primary btn-sm w-100" onclick="addToCart(event, '${p.id}')">
                    <i class="bi bi-cart-plus-fill"></i> Add to Cart
                </button>
            </div>
        </div>
    </div>`;
}

// Empty placeholder after removing login page
function renderLoginPage() {} 

function renderWishlistPage() {
    const wishlist = loadWishlist();
    const grid = document.getElementById("wishlistGrid");
    grid.innerHTML = "";
    
    if (wishlist.length === 0) {
        grid.innerHTML = `<p class="col-12 text-center text-muted p-5 lead">Your wishlist is empty. <a href="#home">Click here to start shopping!</a></p>`;
        return;
    }

    // Use the generic card creator which now includes the dynamic "Remove" button logic
    grid.innerHTML = wishlist.map(createProductCard).join('');
}

function renderCartPage() {
    const cart = loadCart();
    const container = document.getElementById("cartContent");
    container.innerHTML = "";
    
    if (cart.length === 0) {
        container.innerHTML = `<p class="col-12 text-center text-muted p-5 lead">Your cart is empty. <a href="#home">Start browsing our catalog!</a></p>`;
        return;
    }
    
    let total = 0;
    
    let tableRows = cart.map(item => {
        const subtotal = item.price * item.quantity;
        total += subtotal;
        
        const itemImg = item.img ? item.img.replace(/1200\/400/, '100/75') : 'https://via.placeholder.com/100/eee?text=Item';
        
        return `
            <tr>
                <td><img src="${itemImg}" class="rounded" style="width: 60px; height: 45px; object-fit: cover;"></td>
                <td>${item.title}</td>
                <td>‚Çπ${item.price.toLocaleString('en-IN')}</td>
                <td>
                    <div class="input-group input-group-sm" style="width: 130px;">
                        <button class="btn btn-outline-secondary" type="button" onclick="updateCartQuantity('${item.id}', -1)">-</button>
                        <input type="text" class="form-control text-center" value="${item.quantity}" readonly>
                        <button class="btn btn-outline-secondary" type="button" onclick="updateCartQuantity('${item.id}', 1)">+</button>
                    </div>
                </td>
                <td><strong>‚Çπ${subtotal.toLocaleString('en-IN')}</strong></td>
                <td><button class="btn btn-danger btn-sm" onclick="removeFromCart('${item.id}')"><i class="bi bi-trash"></i></button></td>
            </tr>
        `;
    }).join('');
    
    const cartHTML = `
        <div class="col-lg-9">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th colspan="2">Product</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Subtotal</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    ${tableRows}
                </tbody>
            </table>
        </div>
        <div class="col-lg-3">
            <div class="card p-4 shadow-sm bg-light">
                <h4 class="mb-3">Cart Summary</h4>
                <div class="d-flex justify-content-between fs-5 fw-bold mb-3">
                    <span>Grand Total:</span>
                    <span>‚Çπ${total.toLocaleString('en-IN')}</span>
                </div>
                <button class="btn btn-success btn-lg w-100" onclick="window.location.hash='#checkout'">
                    <i class="bi bi-bag-check-fill"></i> Checkout
                </button>
            </div>
        </div>
    `;
    
    container.innerHTML = cartHTML;
}


/* ---------------------------------------------------------
    CATALOG RENDERING & FILTERING (FIXED & UNIFIED)
--------------------------------------------------------- */

/**
 * The Master Renderer: It looks at the Search Box AND both Dropdowns 
 * simultaneously to ensure filters never conflict.
 */
function renderCatalog() {
    const products = loadProducts(); 
    
    // 1. Grab current UI states
    const searchInput = document.getElementById("desktopSearchInput");
    const normalizedSearch = searchInput ? searchInput.value.toLowerCase().trim() : "";
    
    const decorFilter = document.getElementById("decorCategoryFilter") ? document.getElementById("decorCategoryFilter").value : "All";
    const idolFilter = document.getElementById("idolCategoryFilter") ? document.getElementById("idolCategoryFilter").value : "All";

    const decorGrid = document.getElementById("decorGrid");
    const idolsGrid = document.getElementById("idolsGrid");

    if (!decorGrid || !idolsGrid) return;

    // 2. Clear current view
    decorGrid.innerHTML = "";
    idolsGrid.innerHTML = "";

    let hasDecor = false;
    let hasIdols = false;

    // 3. Filter and Distribute
    products.forEach(p => {
        // Condition A: Search Match
        const matchesSearch = p.title.toLowerCase().includes(normalizedSearch) || 
                              p.desc.toLowerCase().includes(normalizedSearch);
        
        if (!matchesSearch) return; 

        const decorCategories = ["Marriage", "Birthday", "Corporate", "Baby Shower", "Cultural", "Festival", "Lighting & Furnishings", "Accessories"];
        const idolCategories = ["Ganesh", "Saraswati", "Custom", "Durga", "Shiva", "Krishna", "Hanuman", "Lakshmi", "Buddhist", "Zodiac/Planets", "Religious Accessories", "Yantra", "Service"];

        // Condition B: Category Logic
        if (decorCategories.includes(p.category)) {
            if (decorFilter === "All" || decorFilter === p.category) {
                decorGrid.innerHTML += createProductCard(p);
                hasDecor = true;
            }
        } else if (idolCategories.includes(p.category)) {
            if (idolFilter === "All" || idolFilter === p.category) {
                idolsGrid.innerHTML += createProductCard(p);
                hasIdols = true;
            }
        }
    });

    // 4. Empty State Handlers
    if (!hasDecor) {
        decorGrid.innerHTML = `<p class="col-12 text-muted text-center py-3">No decorations found matching your search/filter.</p>`;
    }
    if (!hasIdols) {
        idolsGrid.innerHTML = `<p class="col-12 text-muted text-center py-3">No idols found matching your search/filter.</p>`;
    }
}

/**
 * Triggered by the search input's onkeyup event.
 */
function filterProducts() {
    const hash = window.location.hash;
    const searchTerm = document.getElementById("desktopSearchInput").value;

    if (hash === '#home' || hash === '' || hash === '#main-catalog-view') {
        renderCatalog(); 
    } else if (hash === '#all-decor') {
        renderAllDecorPage(searchTerm); // Pass search to Decor page
    } else if (hash === '#all-idols') {
        renderAllIdolsPage(searchTerm); // Pass search to Idols page
    }
}

/**
 * Resets all UI elements and shows the full catalog.
 */
function clearFilters() {
    const searchInput = document.getElementById("desktopSearchInput");
    if (searchInput) searchInput.value = "";
    
    const dFilter = document.getElementById("decorCategoryFilter");
    const iFilter = document.getElementById("idolCategoryFilter");
    if (dFilter) dFilter.value = "All";
    if (iFilter) iFilter.value = "All";
    
    renderCatalog();
}

/* --- FULL PAGE RENDERERS (Kept for navigation) --- */

function renderAllDecorPage(searchTerm = "") {
    const products = loadProducts();
    const decorCategories = ["Marriage", "Birthday", "Corporate", "Baby Shower", "Cultural", "Festival", "Lighting & Furnishings", "Accessories"];
    
    // Combine default and extra products first
    let decorProducts = products.filter(p => decorCategories.includes(p.category));
    const needed = Math.max(0, 50 - decorProducts.length);
    if (needed > 0) {
        decorProducts = decorProducts.concat(generateExtraProducts("d_extra", needed, true));
    }

    // NEW: Filter by search term
    if (searchTerm) {
        decorProducts = decorProducts.filter(p => 
            p.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
            p.category.toLowerCase().includes(searchTerm.toLowerCase())
        );
    }

    const grid = document.getElementById("allDecorGrid");
    if (grid) {
        grid.innerHTML = decorProducts.length > 0 ? 
            decorProducts.map(createProductCard).join('') : 
            `<p class="col-12 text-center py-5 text-muted">No matching decorations found.</p>`;
    }
}
function renderAllIdolsPage(searchTerm = "") {
    const products = loadProducts();
    const idolCategories = ["Ganesh", "Saraswati", "Custom", "Durga", "Shiva", "Krishna", "Hanuman", "Lakshmi", "Buddhist", "Zodiac/Planets", "Religious Accessories", "Yantra", "Service"];
    
    // Combine default and extra products first
    let idolProducts = products.filter(p => idolCategories.includes(p.category));
    const needed = Math.max(0, 50 - idolProducts.length);
    if (needed > 0) {
        idolProducts = idolProducts.concat(generateExtraProducts("i_extra", needed, false));
    }

    // NEW: Filter by search term
    if (searchTerm) {
        idolProducts = idolProducts.filter(p => 
            p.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
            p.category.toLowerCase().includes(searchTerm.toLowerCase())
        );
    }

    const grid = document.getElementById("allIdolsGrid");
    if (grid) {
        grid.innerHTML = idolProducts.length > 0 ? 
            idolProducts.map(createProductCard).join('') : 
            `<p class="col-12 text-center py-5 text-muted">No matching idols found.</p>`;
    }
}


/* ---------------------------------------------------------
    SPA ROUTER (Unchanged)
--------------------------------------------------------- */
function router() {
    const hash = window.location.hash || '#home';
    const views = document.querySelectorAll('.content-view');
    
    // Hide all views
    views.forEach(view => view.classList.remove('active'));

    // Show the relevant view and render its content
    switch (hash) {
        case '#home':
            document.getElementById('main-catalog-view').classList.add('active');
            renderCatalog(document.getElementById("desktopSearchInput").value); 
            break;
        case '#all-decor':
            document.getElementById('all-decor-view').classList.add('active');
            renderAllDecorPage();
            break;
        case '#all-idols':
            document.getElementById('all-idols-view').classList.add('active');
            renderAllIdolsPage();
            break;
        case '#wishlist':
            document.getElementById('wishlist-page-view').classList.add('active');
            renderWishlistPage();
            break;
        case '#cart':
            document.getElementById('cart-page-view').classList.add('active');
            renderCartPage();
            break;
        case '#checkout':
            document.getElementById('checkout-page-view').classList.add('active');
            renderCheckout();
            break;
        case '#payment':
            document.getElementById('payment-page-view').classList.add('active');
            break;
        case '#orders':
            document.getElementById('orders-page-view').classList.add('active');
            renderOrders();
            break;
        default:
            window.location.hash = '#home';
            break;
    }
    
    window.scrollTo(0, 0);
}

/* ---------------------------------------------------------
    PRODUCT DETAIL MODAL (Updated to use findProductById)
--------------------------------------------------------- */
function openProductDetail(id) {
    // UPDATED: Use the universal finder
    const p = findProductById(id);
    if (!p) return;

    document.getElementById("productDetailTitle").innerText = p.title;
    document.getElementById("productDetailImage").src = p.img.replace(/1200\/400/, '500/350');
    document.getElementById("productDetailCategory").innerText = `Category: ${p.category} | Rating: ${p.rating} | Purchases: ${p.purchases}`;
    document.getElementById("productDetailPrice").innerText = "‚Çπ" + p.price.toLocaleString('en-IN');
    document.getElementById("productDetailDescription").innerText = p.desc;

    document.getElementById("modalBuyButton").onclick = () => {
        alert("Buy option coming soon! Using mock payment (see Admin Panel).");
    };

    document.getElementById("modalEnquiryButton").onclick = () => {
        window.location.href = "https://wa.me/919999999999?text=Hello! I want to enquire about " + encodeURIComponent(p.title);
    };

    new bootstrap.Modal(document.getElementById("productDetailModal")).show();
}

/* ---------------------------------------------------------
    ADMIN PANEL (Kept only for hidden functionality)
--------------------------------------------------------- */
// Placeholder functions for admin operations:
let currentProduct = null;
function renderAdminProducts() { /* ... */ }
function renderBookings() { /* ... */ }
function showProductForm(isEdit = false) { 
    document.getElementById('productForm').style.display = 'block';
    document.getElementById('productFormTitle').innerText = isEdit ? 'Edit Product' : 'Add Product';
}
function hideProductForm() { 
    document.getElementById('productForm').style.display = 'none';
    currentProduct = null;
}
function editProduct(id) {
    currentProduct = loadProducts().find(p => p.id === id);
    if (!currentProduct) return;
    document.getElementById('p_title').value = currentProduct.title;
    document.getElementById('p_price').value = currentProduct.price;
    document.getElementById('p_image').value = currentProduct.img;
    document.getElementById('p_category').value = currentProduct.category;
    document.getElementById('p_desc').value = currentProduct.desc;
    showProductForm(true);
}
function saveProduct() {
    const newProduct = {
        id: currentProduct ? currentProduct.id : 'temp-' + Date.now(),
        title: document.getElementById('p_title').value,
        price: parseInt(document.getElementById('p_price').value),
        img: document.getElementById('p_image').value,
        category: document.getElementById('p_category').value,
        desc: document.getElementById('p_desc').value,
        rating: currentProduct ? currentProduct.rating : 4.5,
        purchases: currentProduct ? currentProduct.purchases : 0,
        stock: currentProduct ? currentProduct.stock : 10
    };
    
    let products = loadProducts();
    if (currentProduct) {
        products = products.map(p => p.id === newProduct.id ? newProduct : p);
    } else {
        products.push(newProduct);
    }
    saveProducts(products);
    hideProductForm();
    renderAdminProducts();
    alert('Product saved (mock action)');
}
function deleteProduct(id) { /* ... */ }
function openAdmin() {
    // Only kept for the clickable footer link
    alert("Admin Panel is a mock interface for this prototype.");
    // renderAdminProducts();
    // renderBookings();
    // new bootstrap.Modal(document.getElementById("adminModal")).show();
}


/* ---------------------------------------------------------
    GOOGLE TRANSLATE (Unchanged)
--------------------------------------------------------- */
function googleTranslateElementInit() {
    // Included 15 Indian languages: English, Hindi, Bengali, Telugu, Marathi, Tamil, Urdu, Gujarati, Kannada, Malayalam, Punjabi, Odia, Assamese, Nepali, Marathi
    const includedLanguages = "en,hi,bn,te,mr,ta,ur,gu,kn,ml,pa,or,as,ne"; 

    new google.translate.TranslateElement(
        { 
            pageLanguage: "en", 
            includedLanguages: includedLanguages,
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false 
        },
        "google_translate_element_hidden"
    );

    setTimeout(() => {
        let select = document.querySelector("#google_translate_element_hidden .goog-te-combo");
        if (select) {
            const syncTranslation = (value) => {
                select.value = value;
                select.dispatchEvent(new Event("change"));
            };

            let customDesktop = document.createElement("select");
            customDesktop.id = "language-select-custom";
            customDesktop.className = "form-select";
            
            customDesktop.innerHTML = Array.from(select.options)
                .map(option => `<option value="${option.value}" ${option.selected ? 'selected' : ''}>${option.text}</option>`)
                .join('');
                
            let desktopContainer = document.getElementById("google_translate_element_custom");
            if (desktopContainer) {
                desktopContainer.innerHTML = ''; 
                desktopContainer.appendChild(customDesktop);
                
                customDesktop.onchange = function () {
                    syncTranslation(this.value);
                };
            }
        }
    }, 1500); 
}

/* ---------------------------------------------------------
    BOOTSTRAP CAROUSEL INIT FUNCTION (Unchanged)
--------------------------------------------------------- */
function initCarousel() {
    const slides = [
        { img: "https://picsum.photos/1200/400?random=1&tag=luxury-marriage", caption: "Grand Events, Perfect Decor" },
        { img: "https://picsum.photos/1200/400?random=2&tag=luxury-birthday", caption: "Bespoke Themes, Stress-Free Planning" },
        { img: "https://picsum.photos/1200/400?random=3&tag=handmade-idol", caption: "Divine Idols, Handcrafted Quality" }
    ];

    const inner = document.getElementById('carouselInner');
    inner.innerHTML = slides.map((slide, index) => `
        <div class="carousel-item ${index === 0 ? 'active' : ''} carousel-item-custom" style="background-image: url('${slide.img}')">
            <div class="slider-caption">${slide.caption}</div>
        </div>
    `).join('');
}



/* ---------------------------------------------------------
    INIT (Unchanged)
--------------------------------------------------------- */
document.addEventListener("DOMContentLoaded", () => {
    initCarousel(); 
    window.addEventListener('hashchange', router);
    router();
    updateCartCount();
    updateWishlistCount(); 
});

/* --- NEW CORE LOGIC FOR CHECKOUT, LOCATION, INVOICE & ORDERS --- */

/**
 * Uses Browser Geolocation API to detect coordinates 
 * and appends them to the address field.
 */
// This uses "Reverse Geocoding" to get a real address name instead of just numbers
async function detectLocation() {
    const status = document.getElementById('locationStatus');
    const addressBox = document.getElementById('custAddress');
    
    if (!navigator.geolocation) {
        status.innerText = "Location not supported.";
    } else {
        status.innerText = "Detecting Address...";
        navigator.geolocation.getCurrentPosition(async (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            try {
                // Fetching real address name from OpenStreetMap API
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                const data = await response.json();
                addressBox.value = data.display_name; // Fills full address
                status.innerText = "Location Detected ‚úÖ";
            } catch (error) {
                addressBox.value = `Lat: ${lat}, Lon: ${lon}`;
                status.innerText = "Address detection failed, filled coordinates.";
            }
        }, () => { status.innerText = "Access denied."; });
    }
}

function renderCheckout() {
    const cart = loadCart();
    const summaryDiv = document.getElementById('checkoutSummary');
    let subtotal = 0;
    let deliveryTotal = 0;

    summaryDiv.innerHTML = cart.map(item => {
        subtotal += (item.price * item.quantity);
        let fee = item.price > 5000 ? 500 : 150; 
        deliveryTotal += (fee * item.quantity);
        return `<div class="d-flex justify-content-between border-bottom py-2">
                    <span>${item.title} (x${item.quantity})</span>
                    <span>‚Çπ${(item.price * item.quantity).toLocaleString()}</span>
                </div>`;
    }).join('');

    // Added specific Delivery Fee line
    summaryDiv.innerHTML += `
        <div class="d-flex justify-content-between py-2 text-danger fw-bold">
            <span>Delivery Charges (Weight/Size based):</span>
            <span>+ ‚Çπ${deliveryTotal.toLocaleString()}</span>
        </div>`;

    document.getElementById('finalPayableAmount').innerText = `‚Çπ${(subtotal + deliveryTotal).toLocaleString('en-IN')}`;
    document.getElementById('checkoutForm').onsubmit = (e) => { e.preventDefault(); window.location.hash = '#payment'; };
}
/**
 * Finalizes the order, saves it to LocalStorage, and clears the cart.
 */
function processPayment(method) {
    const cart = loadCart();
    let subtotal = 0;
    let deliveryTotal = 0;

    cart.forEach(item => {
        subtotal += (item.price * item.quantity);
        let fee = item.price > 5000 ? 500 : 150;
        deliveryTotal += (fee * item.quantity);
    });

    const newOrder = {
        id: 'ORD-' + Math.floor(Math.random() * 1000000),
        date: new Date().toLocaleString(),
        user: { 
            name: document.getElementById('custName').value, 
            phone: document.getElementById('custPhone').value,
            address: document.getElementById('custAddress').value 
        },
        items: cart,
        total: subtotal + deliveryTotal,
        delFee: deliveryTotal,
        payVia: method,
        status: 'Processing'
    };

    let orders = JSON.parse(localStorage.getItem("art_orders_v3")) || [];
    orders.unshift(newOrder);
    localStorage.setItem("art_orders_v3", JSON.stringify(orders));
    
    saveCart([]); 
    window.location.hash = '#orders';
}

/**
 * Displays all past orders. If no orders exist, shows a "Buy Product" button.
 */
function renderOrders() {
    const container = document.getElementById('ordersContainer');
    const orders = JSON.parse(localStorage.getItem("art_orders_v3")) || [];

    if (!orders.length) {
        container.innerHTML = `
            <div class="text-center py-5">
                <i class="bi bi-bag-x fs-1 text-muted"></i>
                <p class="lead mt-3">You have no orders yet.</p>
                <a href="#home" class="btn btn-primary btn-lg mt-2">Buy Product</a>
            </div>`;
        return;
    }

    container.innerHTML = orders.map(o => `
        <div class="card mb-3 shadow-sm border-0 bg-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h5 class="mb-1">Order ID: ${o.id}</h5>
                        <p class="small text-muted mb-2"><i class="bi bi-calendar3"></i> ${o.date}</p>
                    </div>
                    <span class="badge rounded-pill bg-success-subtle text-success border border-success px-3">${o.status}</span>
                </div>
                <div class="py-2 border-top border-bottom my-2">
                    ${o.items.map(i => `<div class="small">‚Ä¢ ${i.title} (x${i.quantity})</div>`).join('')}
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <h5 class="text-primary mb-0">Total: ‚Çπ${o.total.toLocaleString()}</h5>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-primary" onclick="downloadInvoice('${o.id}')">
                            <i class="bi bi-download"></i> Invoice
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteOrder('${o.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

/**
 * Removes a single order from history.
 */
function deleteOrder(id) {
    if(confirm("Delete this order from history?")) {
        let orders = JSON.parse(localStorage.getItem("art_orders_v3")).filter(o => o.id !== id);
        localStorage.setItem("art_orders_v3", JSON.stringify(orders));
        renderOrders();
    }
}
/**
 * Clears the entire order database.
 */
function clearAllOrders() {
    if(confirm("Are you sure you want to clear ALL order history?")) { 
        localStorage.setItem("art_orders_v3", "[]"); 
        renderOrders(); 
    }
}
</script>
<div class="d-md-none fixed-bottom bg-white border-top d-flex justify-content-around align-items-center py-2 shadow-lg" style="z-index: 1050;">
    <a href="#home" class="text-center text-decoration-none text-dark">
        <i class="bi bi-house-door fs-4"></i>
        <div style="font-size: 10px;">Home</div>
    </a>
    <a href="#wishlist" class="text-center text-decoration-none text-dark position-relative">
        <i class="bi bi-heart fs-4"></i>
        <span class="wishlist-count-badge" style="top: -2px; right: -8px;">0</span>
        <div style="font-size: 10px;">Wishlist</div>
    </a>
    <a href="#cart" class="text-center text-decoration-none text-dark position-relative">
        <i class="bi bi-cart3 fs-4"></i>
        <span class="cart-count-badge" style="top: -2px; right: -8px;">0</span>
        <div style="font-size: 10px;">Cart</div>
    </a>
    <a href="#orders" class="text-center text-decoration-none text-dark">
        <i class="bi bi-bag-check fs-4"></i>
        <div style="font-size: 10px;">Orders</div>
    </a>
</div>
</body>
</html>
